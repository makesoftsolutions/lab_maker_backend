      if (sawRadix) {
          firstNonZero = firstNonZero + 1;
        }
        // if saw sign, we need to increment again to account for - or + sign at start.
        if (sawSign) {
          firstNonZero = firstNonZero + 1;
        }

        const roundDigit = parseInt(representation[firstNonZero + lastDigit + 1], 10);

        if (roundDigit !== 0) {
          invalidErr(representation, 'inexact rounding');
        }
      }
    }

    // Encode significand
    // The high 17 digits of the significand
    significandHigh = Long.fromNumber(0);
    // The low 17 digits of the significand
    significandLow = Long.fromNumber(0);

    // read a zero
    if (significantDigits === 0) {
      significandHigh = Long.fromNumber(0);
      significandLow = Long.fromNumber(0);
    } else if (lastDigit < 17) {
      let dIdx = 0;
      significandLow = Long.fromNumber(digits[dIdx++]);
      significandHigh = new Long(0, 0);

      for (; dIdx <= lastDigit; dIdx++) {
        significandLow = significandLow.multiply(Long.fromNumber(10));
        significandLow = significandLow.add(Long.fromNumber(digits[dIdx]));
      }
    } else {
      let dIdx = 0;
      significandHigh = Long.fromNumber(digits[dIdx++]);

      for (; dIdx <= lastDigit - 17; dIdx++) {
        significandHigh = significandHigh.multiply(Long.fromNumber(10));
        significandHigh = significandHigh.add(Long.fromNumber(digits[dIdx]));
      }

      significandLow = Long.fromNumber(digits[dIdx++]);

      for (; dIdx <= lastDigit; dIdx++) {
        significandLow = significandLow.multiply(Long.fromNumber(10));
        significandLow = significandLow.add(Long.fromNumber(digits[dIdx]));
      }
    }

    const significand = multiply64x2(significandHigh, Long.fromString('100000000000000000'));
    significand.low = significand.low.add(significandLow);

    if (lessThan(significand.low, significandLow)) {
      significand.high = significand.high.add(Long.fromNumber(1));
    }

    // Biased exponent
    biasedExponent = exponent + EXPONENT_BIAS;
    const dec = { low: Long.fromNumber(0), high: Long.fromNumber(0) };

    // Encode combination, exponent, and significand.
    if (
      significand.high.shiftRightUnsigned(49).and(Long.fromNumber(1)).equals(Long.fromNumber(1))
    ) {
      // Encode '11' into bits 1 to 3
      dec.high = dec.high.or(Long.fromNumber(0x3).shiftLeft(61));
      dec.high = dec.high.or(
        Long.fromNumber(biasedExponent).and(Long.fromNumber(0x3fff).shiftLeft(47))
      );
      dec.high = dec.high.or(significand.high.and(Long.fromNumber(0x7fffffffffff)));
    } else {
      dec.high = dec.high.or(Long.fromNumber(biasedExponent & 0x3fff).shiftLeft(49));
      dec.high = dec.high.or(significand.high.and(Long.fromNumber(0x1ffffffffffff)));
    }

    dec.low = significand.low;

    // Encode sign
    if (isNegative) {
      dec.high = dec.high.or(Long.fromString('9223372036854775808'));
    }

    // Encode into a buffer
    const buffer = ByteUtils.allocate(16);
    index = 0;

    // Encode the low 64 bits of the decimal
    // Encode low bits
    buffer[index++] = dec.low.low & 0xff;
    buffer[index++] = (dec.low.low >> 8) & 0xff;
    buffer[index++] = (dec.low.low >> 16) & 0xff;
    buffer[index++] = (dec.low.low >> 24) & 0xff;
    // Encode high bits
    buffer[index++] = dec.low.high & 0xff;
    buffer[index++] = (dec.low.high >> 8) & 0xff;
    buffer[index++] = (dec.low.high >> 16) & 0xff;
    buffer[index++] = (dec.low.high >> 24) & 0xff;

    // Encode the high 64 bits of the decimal
    // Encode low bits
    buffer[index++] = dec.high.low & 0xff;
    buffer[index++] = (dec.high.low >> 8) & 0xff;
    buffer[index++] = (dec.high.low >> 16) & 0xff;
    buffer[index++] = (dec.high.low >> 24) & 0xff;
    // Encode high bits
    buffer[index++] = dec.high.high & 0xff;
    buffer[index++] = (dec.high.high >> 8) & 0xff;
    buffer[index++] = (dec.high.high >> 16) & 0xff;
    buffer[index++] = (dec.high.high >> 24) & 0xff;

    // Return the new Decimal128
    return new Decimal128(buffer);
  }
  /** Create a string representation of the raw Decimal128 value */
  toString(): string {
    // Note: bits in this routine are referred to starting at 0,
    // from the sign bit, towards the coefficient.

    // decoded biased exponent (14 bits)
    let biased_exponent;
    // the number of significand digits
    let significand_digits = 0;
    // the base-10 digits in the significand
    const significand = new Array<number>(36);
    for (let i = 0; i < significand.length; i++) significand[i] = 0;
    // read pointer into significand
    let index = 0;

    // true if the number is zero
    let is_zero = false;

    // the most significant significand bits (50-46)
    let significand_msb;
    // temporary storage for significand decoding
    let significand128: { parts: [number, number, number, number] } = { parts: [0, 0, 0, 0] };
    // indexing variables
    let j, k;

    // Output string
    const string: string[] = [];

    // Unpack index
    index = 0;

    // Buffer reference
    const buffer = this.bytes;

    // Unpack the low 64bits into a long
    // bits 96 - 127
    const low =
      buffer[index++] | (buffer[index++] << 8) | (buffer[index++] << 16) | (buffer[index++] << 24);
    // bits 64 - 95
    const midl =
      buffer[index++] | (buffer[index++] << 8) | (buffer[index++] << 16) | (buffer[index++] << 24);

    // Unpack the high 64bits into a long
    // bits 32 - 63
    const midh =
      buffer[index++] | (buffer[index++] << 8) | (buffer[index++] << 16) | (buffer[index++] << 24);
    // bits 0 - 31
    const high =
      buffer[index++] | (buffer[index++] << 8) | (buffer[index++] << 16) | (buffer[index++] << 24);

    // Unpack index
    index = 0;

    // Create the state of the decimal
    const dec = {
      low: new Long(low, midl),
      high: new Long(midh, high)
    };

    if (dec.high.lessThan(Long.ZERO)) {
      string.push('-');
    }

    // Decode combination field and exponent
    // bits 1 - 5
    const combination = (high >> 26) & COMBINATION_MASK;

    if (combination >> 3 === 3) {
      // Check for 'special' values
      if (combination === COMBINATION_INFINITY) {
        return string.join('') + 'Infinity';
      } else if (combination === COMBINATION_NAN) {
        return 'NaN';
      } else {
        biased_exponent = (high >> 15) & EXPONENT_MASK;
        significand_msb = 0x08 + ((high >> 14) & 0x01);
      }
    } else {
      significand_msb = (high >> 14) & 0x07;
      biased_exponent = (high >> 17) & EXPONENT_MASK;
    }

    // unbiased exponent
    const exponent = biased_exponent - EXPONENT_BIAS;

    // Create string of significand digits

    // Convert the 114-bit binary number represented by
    // (significand_high, significand_low) to at most 34 decimal
    // digits through modulo and division.
    significand128.parts[0] = (high & 0x3fff) + ((significand_msb & 0xf) << 14);
    significand128.parts[1] = midh;
    significand128.parts[2] = midl;
    significand128.parts[3] = low;

    if (
      significand128.parts[0] === 0 &&
      significand128.parts[1] === 0 &&
      significand128.parts[2] === 0 &&
      significand128.parts[3] === 0
    ) {
      is_zero = true;
    } else {
      for (k = 3; k >= 0; k--) {
        let least_digits = 0;
        // Perform the divide
        const result = divideu128(significand128);
        significand128 = result.quotient;
        least_digits = result.rem.low;

        // We now have the 9 least significant digits (in base 2).
        // Convert and output to string.
        if (!least_digits) continue;

        for (j = 8; j >= 0; j--) {
          // significand[k * 9 + j] = Math.round(least_digits % 10);
          significand[k * 9 + j] = least_digits % 10;
          // least_digits = Math.round(least_digits / 10);
          least_digits = Math.floor(least_digits / 10);
        }
      }
    }

    // Output format options:
    // Scientific - [-]d.dddE(+/-)dd or [-]dE(+/-)dd
    // Regular    - ddd.ddd

    if (is_zero) {
      significand_digits = 1;
      significand[index] = 0;
    } else {
      significand_digits = 36;
      while (!significand[index]) {
        significand_digits = significand_digits - 1;
        index = index + 1;
      }
    }

    // the exponent if scientific notation is used
    const scientific_exponent = significand_digits - 1 + exponent;

    // The scientific exponent checks are dictated by the string conversion
    // specification and are somewhat arbitrary cutoffs.
    //
    // We must check exponent > 0, because if this is the case, the number
    // has trailing zeros.  However, we *cannot* output these trailing zeros,
    // because doing so would change the precision of the value, and would
    // change stored data if the string converted number is round tripped.
    if (scientific_exponent >= 34 || scientific_exponent <= -7 || exponent > 0) {
      // Scientific format

      // if there are too many significant digits, we should just be treating numbers
      // as + or - 0 and using the non-scientific exponent (this is for the "invalid
      // representation should be treated as 0/-0" spec cases in decimal128-1.json)
      if (significand_digits > 34) {
        string.push(`${0}`);
        if (exponent > 0) string.push(`E+${exponent}`);
        else if (exponent < 0) string.push(`E${exponent}`);
        return string.join('');
      }

      string.push(`${significand[index++]}`);
      significand_digits = significand_digits - 1;

      if (significand_digits) {
        string.push('.');
      }

      for (let i = 0; i < significand_digits; i++) {
        string.push(`${significand[index++]}`);
      }

      // Exponent
      string.push('E');
      if (scientific_exponent > 0) {
        string.push(`+${scientific_exponent}`);
      } else {
        string.push(`${scientific_exponent}`);
      }
    } else {
      // Regular format with no decimal place
      if (exponent >= 0) {
        for (let i = 0; i < significand_digits; i++) {
          string.push(`${significand[index++]}`);
        }
      } else {
        let radix_position = significand_digits + exponent;

        // non-zero digits before radix
        if (radix_position > 0) {
          for (let i = 0; i < radix_position; i++) {
            string.push(`${significand[index++]}`);
          }
        } else {
          string.push('0');
        }

        string.push('.');
        // add leading zeros after radix
        while (radix_position++ < 0) {
          string.push('0');
        }

        for (let i = 0; i < significand_digits - Math.max(radix_position - 1, 0); i++) {
          string.push(`${significand[index++]}`);
        }
      }
    }

    return string.join('');
  }

  toJSON(): Decimal128Extended {
    return { $numberDecimal: this.toString() };
  }

  /** @internal */
  toExtendedJSON(): Decimal128Extended {
    return { $numberDecimal: this.toString() };
  }

  /** @internal */
  static fromExtendedJSON(doc: Decimal128Extended): Decimal128 {
    return Decimal128.fromString(doc.$numberDecimal);
  }

  /** @internal */
  [Symbol.for('nodejs.util.inspect.custom')](): string {
    return this.inspect();
  }

  inspect(): string {
    return `new Decimal128("${this.toString()}")`;
  }
}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ðYé÷LjÚDé÷LjÚDé÷LjÚDé÷LjÚ @      ¤=              È3D     ¯3D             (                      (   (                     ÿÿÿÿÿÿÿÿÓ3D                     X                       (  @        I       I       @      ¤=      ¤=       @              ¤=      ä3D     Ó3D             (                      (   (                     ÿÿÿÿÿÿÿÿï3D                     0                       (  (  ˜                 ˆ      (                                           FÿRCRD( 	 ê5D          P      ß5D     Gÿ           Ú      4D     ï3D     ï3D     0                       (   (           J       J      FILE0  4D     4D     4D     0                       (  (  p                Üÿ     ¬P      4D     4D     4D     ˆ                      ( ` ˆ     ø ¨   I       I      (     ` P     &     xYî÷LjÚxYî÷LjÚxYî÷LjÚxYî÷LjÚ                         b s o n . t s 74D      4D      4D     x                      ( Px          GÿJ       J      FILE0  4D       8  P                (            `           H      xYî÷LjÚxYî÷LjÚxYî÷LjÚxYî÷LjÚ                                      0   h          P     &     xYî÷LjÚxYî÷LjÚxYî÷LjÚxYî÷LjÚ                         b s o n . t s €   H                        @                               1¬Ð   ÿÿÿÿ‚yGl4D     74D             (                      (   (                     ÿÿÿÿÿÿÿÿw4D                     X                       (  @         GÿJ       J                      Æ                              ˆ4D     w4D             (                      (   (                     ÿÿÿÿÿÿÿÿ“4D                     ˜                       ( 8 ` 8   ø ¨   I       I      xYî÷LjÚxYî÷LjÚxYî÷LjÚxYî÷LjÚ        Æ              xYî÷LjÚxYî÷LjÚxYî÷LjÚxYî÷LjÚ                        ¬4D     “4D             (                      (   (                     ÿÿÿÿÿÿÿÿ·4D                     ¨                       ( @ h @   8     GÿJ       J       ^œ–OÚ´Ù“É–OÚî÷LjÚ                                      xYî÷LjÚxYî÷LjÚxYî÷LjÚ                                      Ò4D     ·4D             (                      (   (                     ÿÿÿÿÿÿÿÿÝ4D                     ˜                       ( 8 ` 8   ø ¨   I       I      xYî÷LjÚ ^œ–OÚ´Ù“É–OÚî÷LjÚ        Æ              xYî÷LjÚxYî÷LjÚxYî÷LjÚxYî÷LjÚ        Æ              ö4D     Ý4D             (                      (   (                   Gÿÿÿÿÿÿÿÿÿ5D                     X                       (  @          J       J              Æ      Æ                      Æ      5D     5D             (                      (   (                     ÿÿÿÿÿÿÿÿ5D                     0                       (  (  ˜                 ˆ      )     )5D     5D     5D     0                       (   (          J       J      FILE0  55D     )5D     )5D     ˜                      ( p ˜     ø   I       I    Gÿ)     p \     &     	ÿó÷LjÚ	ÿó÷LjÚ	ÿó÷LjÚ	ÿó÷LjÚ                         b s o n _ v a l u e . t s     N5D     55D     55D     X                      ( 0X          J       J      FILE0  )5D       8  0                )            `           H      	ÿó÷LjÚ	ÿó÷LjÚ	ÿó÷LjÚ	ÿó÷LjÚ                                      0   x          \     &     	ÿó÷LjÚ	ÿó÷LjÚ	ÿó÷LjÚ	ÿó÷LjÚ                         b s o n _ v a l u e . t s     €                   ÿÿÿÿ‚yG5D   GÿN5D             (                      (   (                     ÿÿÿÿÿÿÿÿŠ5D                     (                      ( ’(        J       J      •5D     Š5D             (                      (   (                     ÿÿÿÿÿÿÿÿ 5D                     ˜                       ( 8 ` 8   ø   I       I      	ÿó÷LjÚ	ÿó÷LjÚ	ÿó÷LjÚ	ÿó÷LjÚ˜      ’              	ÿó÷LjÚ	ÿó÷LjÚ	ÿó÷LjÚ	ÿó÷LjÚ                        ¹5D      5D             (                      ( Gÿ(                     ÿÿÿÿÿÿÿÿÄ5D                     ¨                       ( @ h @   8     J       J       ^œ–OÚÄ ”É–OÚ
&ô÷LjÚ                                      	ÿó÷LjÚ	ÿó÷LjÚ	ÿó÷LjÚ                                      ß5D     Ä5D             (                      (   (                     ÿÿÿÿÿÿÿÿê5D                     ˜                      ( 8 ` 8   ø   I       I      	ÿó÷LjÚ ^œ–OÚÄ ”É–OÚ
&ô÷LjÚ˜      ’              	ÿó÷LjÚ	ÿó÷LjÚ	ÿó÷LjÚ	ÿó÷LjGÿRCRD( 	 ÷7D          ¸      é7D     HÿÚ   Ú             ˜      ’              6D     ê5D             (                      (   (                     ÿÿÿÿÿÿÿÿ6D                     0                       (  (  ˜                 ˆ      *     "6D     6D     6D     0                       (   (          J       J      FILE0  .6D     "6D     "6D     ˆ                      ( ` ˆ     ø x  I       I      *     ` P     &     QÓ÷÷LjÚQÓ÷÷LjÚQÓ÷÷LjÚQÓ÷÷LjHÿ                         c o d e . t s E6D     .6D     .6D     H                      (  H          J       J      FILE0  "6D       8                   *            `           H      QÓ÷÷LjÚQÓ÷÷LjÚQÓ÷÷LjÚQÓ÷÷LjÚ                                      0   h          P     &     QÓ÷÷LjÚQÓ÷÷LjÚQÓ÷÷LjÚQÓ÷÷LjÚ                         c o d e . t s €                   ÿÿÿÿ‚yGt6D     E6D             (                      (   (                     ÿÿÿÿÿÿÿÿ6D   Hÿ                @                      (   (         J       J      €                   6D     6D     6D     (                    %   ( ø(         J       J      ˜6D     6D     6D     p                      ( H p          J       J      €   H                 ÿÿÿÿÿÿÿÿ@                                       ¬6D     ˜6D     ˜6D     0                       (  (  p                Üÿ     ®P     ¸6D     ¬6D     ¬6D     X                       (  @   Hÿ     J       J                                                     É6D     ¸6D     ¸6D     8                     	 	 (  0     @   J       J      1®Ð           Ö6D     É6D     É6D     X                       (  @         J       J                                                  ç6D     Ö6D             (                      (   (                     ÿÿÿÿÿÿÿÿò6D                     ˜                       ( 8 ` 8   ø x  I       I      QÓ÷÷LjÚQÓ÷÷LjÚQÓ÷÷LjHÿQÓ÷÷LjÚ                     QÓ÷÷LjÚQÓ÷÷LjÚQÓ÷÷LjÚQÓ÷÷LjÚ                        7D     ò6D             (                      (   (                     ÿÿÿÿÿÿÿÿ7D                     ¨                       ( @ h @   8     J       J       ^œ–OÚÄ ”É–OÚ1ø÷LjÚ                                      QÓ÷÷LjÚQÓ÷÷LjÚQÓ÷÷LjÚ                                      17D     7D             (                      (   (                     ÿÿÿÿÿÿÿÿ<7D                     ˜     Hÿ                ( 8 ` 8   ø x  I       I      QÓ÷÷LjÚ ^œ–OÚÄ ”É–OÚ1ø÷LjÚ                     QÓ÷÷LjÚQÓ÷÷LjÚQÓ÷÷LjÚQÓ÷÷LjÚ                     U7D     <7D             (                      (   (                     ÿÿÿÿÿÿÿÿ`7D                     X                       (  @         J       J                                              q7D     `7D             (                      (   (                     ÿÿÿÿÿÿÿÿ|7D                     0     Hÿ                (  (  ˜                 ˆ      +     ˆ7D     |7D     |7D     0                       (   (          J       J      FILE0  ”7D     ˆ7D     ˆ7D     ˜                      ( p ˜     ø Ø  I       I      +     p Z     &     "pü÷LjÚ"pü÷LjÚ"pü÷LjÚ"pü÷LjÚ                         c o n s t a n t s . t s       ­7D     ”7D     ”7D     X                      ( 0X          J       J      FILE0  ˆ7D       8  0                +            ` Hÿ        H      "pü÷LjÚ"pü÷LjÚ"pü÷LjÚ"pü÷LjÚ                                      0   x          Z     &     "pü÷LjÚ"pü÷LjÚ"pü÷LjÚ"pü÷LjÚ                         c o n s t a n t s . t s       €                   ÿÿÿÿ‚yGÞ7D     ­7D             (                      (   (                     ÿÿÿÿÿÿÿÿé7D                     @                      (   (        J       J      €                   ÷7D     é7D     é7D     (                    %   ( è(        HÿRCRD( 	 ð9D          €      å9D     Iÿ                     J       J      
8D     ÷7D     ÷7D     p                      ( H p         J       J      €   H                 ÿÿÿÿÿÿÿÿ@                                       8D     
8D     
8D     0                       (  (  p                Üÿ     ¯P     *8D     8D     8D     X                       (  @        J       J                                                     ;8D     *8D     *8D     8           Iÿ        	 	 (  0    @   J       J      1¯Ð           H8D     ;8D     ;8D     X                       (  @        J       J                     (                             Y8D     H8D             (                      (   (                     ÿÿÿÿÿÿÿÿd8D                     ˜                       ( 8 ` 8   ø Ø  I       I      "pü÷LjÚ"pü÷LjÚ"pü÷LjÚ"pü÷LjÚ       (              "pü÷LjÚ"pü÷LjÚ"pü÷LjÚ"pü÷LjÚ                        }8D     d8D           Iÿ(                      (   (                     ÿÿÿÿÿÿÿÿˆ8D                     ¨                       ( @ h @   8     J       J       ^œ–OÚØ'”É–OÚ«¢ü÷LjÚ                                      "pü÷LjÚ"pü÷LjÚ"pü÷LjÚ                                      £8D     ˆ8D             (                      (   (                     ÿÿÿÿÿÿÿÿ®8D                     ˜                       ( 8 ` 8   ø Ø  I       I      "pü÷LjÚ ^œ–OÚØ'”É–OÚ«¢ü÷LjÚ       (            Iÿ"pü÷LjÚ"pü÷LjÚ"pü÷LjÚ"pü÷LjÚ       (              Ç8D     ®8D             (                      (   (                     ÿÿÿÿÿÿÿÿÒ8D                     X                       (  @        J       J             (      (                     (      ã8D     Ò8D             (                      (   (                     ÿÿÿÿÿÿÿÿî8D                     0                       (  (  ˜                 ˆ      ,     ú8D     î8D     î8D     0                  Iÿ   (   (           K       K      FILE0  9D     ú8D     ú8D                           ( h      ø H  I       I      ,     h T     &     €øLjÚ€øLjÚ€øLjÚ€øLjÚ                        	 d b _ r e f . t s     9D     9D     9D     P                      ( (P           K       K      FILE0  ú8D       8  (                ,            `           H      €øLjÚ€øLjÚ€øLjÚ€øLjÚ                                      0   p          T     &    Iÿ€øLjÚ€øLjÚ€øLjÚ€øLjÚ                        	 d b _ r e f . t s     €                   ÿÿÿÿ‚yGN9D     9D             (                      (   (                     ÿÿÿÿÿÿÿÿY9D                     @                      (   (         K       K      €                   g9D     Y9D     Y9D     (                    %   ( ð(          K       K      r9D     g9D     g9D     p                      ( H p          K       K      €   H               Iÿÿÿÿÿÿÿÿÿ@                                       